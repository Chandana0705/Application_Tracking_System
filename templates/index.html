<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ATS Resume Matcher</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; overflow-x: hidden; }
        .text-gradient { background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* Animated Background Blobs */
        @keyframes blob {
            0% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0px, 0px) scale(1); }
        }
        .animate-blob { animation: blob 7s infinite; }
        .animation-delay-2000 { animation-delay: 2s; }
        .animation-delay-4000 { animation-delay: 4s; }

        /* Drop Zone & Interactions */
        .drop-zone { transition: all 0.3s ease; background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='16' ry='16' stroke='%23CBD5E1FF' stroke-width='2' stroke-dasharray='12%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e"); }
        .drop-zone.active { background-color: #eff6ff; border: none; background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='16' ry='16' stroke='%233B82F6FF' stroke-width='3' stroke-dasharray='12%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e"); transform: scale(1.01); }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <nav class="bg-white/80 backdrop-blur-md sticky top-0 z-50 border-b border-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white">
                        <i class="ph ph-read-cv-logo text-xl"></i>
                    </div>
                    <span class="font-bold text-xl text-gray-900 tracking-tight">ATS<span class="text-blue-600">Matcher</span></span>
                </div>
            </div>
        </div>
    </nav>

    <main class="flex-grow relative flex flex-col items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
        
        <div class="absolute top-0 left-0 w-full h-full overflow-hidden -z-10">
            <div class="absolute top-0 left-1/4 w-72 h-72 bg-purple-300 rounded-full mix-blend-multiply filter blur-xl opacity-30 animate-blob"></div>
            <div class="absolute top-0 right-1/4 w-72 h-72 bg-yellow-300 rounded-full mix-blend-multiply filter blur-xl opacity-30 animate-blob animation-delay-2000"></div>
            <div class="absolute -bottom-8 left-1/3 w-72 h-72 bg-pink-300 rounded-full mix-blend-multiply filter blur-xl opacity-30 animate-blob animation-delay-4000"></div>
        </div>

        <div class="max-w-5xl w-full text-center space-y-8">
            
            <div class="space-y-4">
                <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold text-gray-900 tracking-tight">
                    Check Resume vs <br>
                    <span class="text-gradient">Job Description</span>
                </h1>
                <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                    Paste the job description below, then upload your resume to get an instant ATS match score and AI analysis.
                </p>
            </div>

            <div class="mt-10 relative group">
                <div id="drop-zone" class="drop-zone bg-white rounded-2xl p-6 sm:p-12 text-center shadow-xl shadow-blue-50/50 relative overflow-hidden min-h-[500px] flex flex-col justify-center items-center">
                    
                    <input type="file" id="file-input" class="hidden" accept=".pdf">
                    
                    <div id="state-initial" class="transition-all duration-300 transform w-full max-w-2xl mx-auto">
                        
                        <div class="mb-8 text-left">
                            <label for="jd-input" class="block text-sm font-bold text-gray-700 mb-2 ml-1">
                                <i class="ph ph-briefcase text-blue-600 mr-1"></i> 1. Paste Job Description
                            </label>
                            <textarea id="jd-input" rows="4" 
                                class="w-full p-4 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-50/50 outline-none transition-all resize-none text-sm bg-gray-50 placeholder-gray-400" 
                                placeholder="Paste the job requirements here (e.g. 'Looking for a Python developer with 3 years exp...')..."></textarea>
                        </div>

                        <div class="flex items-center gap-4 mb-8 opacity-60">
                            <div class="h-px bg-gray-300 flex-1"></div>
                            <span class="text-xs font-bold text-gray-400 uppercase tracking-widest">Then</span>
                            <div class="h-px bg-gray-300 flex-1"></div>
                        </div>

                        <div onclick="document.getElementById('file-input').click()" class="cursor-pointer group hover:scale-[1.02] transition-transform">
                            <div class="w-20 h-20 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-blue-100 transition-colors">
                                <i class="ph ph-cloud-arrow-up text-4xl text-blue-600"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-2">2. Upload Resume (PDF)</h3>
                            <button class="mt-4 bg-blue-600 text-white px-8 py-3 rounded-full font-semibold hover:bg-blue-700 transition-all shadow-lg shadow-blue-500/30">
                                Select PDF File
                            </button>
                        </div>
                    </div>

                    <div id="state-uploading" class="hidden absolute inset-0 bg-white z-10 flex flex-col items-center justify-center p-8">
                        <div class="w-16 h-16 relative mb-6">
                            <div class="absolute inset-0 border-4 border-gray-100 rounded-full"></div>
                            <div class="absolute inset-0 border-4 border-blue-600 rounded-full border-t-transparent animate-spin"></div>
                        </div>
                        <h3 class="text-xl font-bold text-gray-900 mb-2">Analyzing Match...</h3>
                        <p id="filename-display" class="text-sm text-gray-500 mb-6 max-w-xs truncate">filename.pdf</p>
                        
                        <div class="w-full max-w-sm space-y-3 text-left">
                            <div class="flex items-center gap-3 text-sm text-gray-600" id="step-1">
                                <i class="ph ph-cpu text-blue-500 animate-pulse"></i> Extracting Resume Data...
                            </div>
                            <div class="flex items-center gap-3 text-sm text-gray-600 hidden" id="step-2">
                                <i class="ph ph-brain text-purple-500 animate-pulse"></i> Comparing with Job Description...
                            </div>
                        </div>
                    </div>

                    <div id="state-success" class="hidden absolute inset-0 bg-white z-20 flex flex-col p-6 sm:p-10 overflow-y-auto w-full text-left">
                        
                        <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-8 pb-8 border-b border-gray-100">
                            <div class="flex-1">
                                <h2 class="text-2xl font-bold text-gray-900">Analysis Results</h2>
                                <p class="text-gray-500 mt-2 text-sm leading-relaxed" id="summary-text">Analysis complete.</p>
                            </div>
                            
                            <div class="mt-6 md:mt-0 md:ml-8 flex items-center gap-4 shrink-0">
                                <div class="text-right hidden md:block">
                                    <div class="text-sm text-gray-500 font-medium">Match Score</div>
                                    <div class="text-xs text-gray-400">Out of 100</div>
                                </div>
                                <div class="w-24 h-24 rounded-full border-4 border-blue-100 flex items-center justify-center bg-blue-50 shadow-inner relative">
                                    <span id="score-display" class="text-3xl font-bold text-blue-600">--</span>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                            <div class="bg-green-50/50 border border-green-100 rounded-xl p-5">
                                <div class="flex items-center gap-2 mb-4">
                                    <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center text-green-600">
                                        <i class="ph ph-thumbs-up text-lg"></i>
                                    </div>
                                    <h3 class="text-lg font-bold text-gray-900">Strengths & Matches</h3>
                                </div>
                                <ul id="strengths-list" class="space-y-3"></ul>
                            </div>

                            <div class="bg-orange-50/50 border border-orange-100 rounded-xl p-5">
                                <div class="flex items-center gap-2 mb-4">
                                    <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center text-orange-600">
                                        <i class="ph ph-warning-circle text-lg"></i>
                                    </div>
                                    <h3 class="text-lg font-bold text-gray-900">Missing / Weaknesses</h3>
                                </div>
                                <ul id="weaknesses-list" class="space-y-3"></ul>
                            </div>
                        </div>

                        <div class="text-center mt-auto pt-4">
                            <button onclick="resetUploader()" class="text-gray-500 hover:text-blue-600 font-medium transition-colors flex items-center justify-center gap-2 mx-auto">
                                <i class="ph ph-arrow-counter-clockwise"></i> Analyze New Resume
                            </button>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const jdInput = document.getElementById('jd-input'); // Reference to the new JD box
        const stateInitial = document.getElementById('state-initial');
        const stateUploading = document.getElementById('state-uploading');
        const stateSuccess = document.getElementById('state-success');
        const filenameDisplay = document.getElementById('filename-display');
        const step1 = document.getElementById('step-1');
        const step2 = document.getElementById('step-2');
        
        // Output Elements
        const scoreDisplay = document.getElementById('score-display');
        const summaryText = document.getElementById('summary-text');
        const strengthsList = document.getElementById('strengths-list');
        const weaknessesList = document.getElementById('weaknesses-list');

        // Drag & Drop Interactions
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(e => {
            document.body.addEventListener(e, (evt) => { evt.preventDefault(); evt.stopPropagation(); });
        });

        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => dropZone.classList.add('active'), false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => dropZone.classList.remove('active'), false);
        });

        dropZone.addEventListener('drop', (e) => {
            const files = e.dataTransfer.files;
            if (files.length) uploadFile(files[0]);
        }, false);

        fileInput.addEventListener('change', function() {
            if (this.files.length) uploadFile(this.files[0]);
        });

        // Core Upload Logic
        async function uploadFile(file) {
            const jdText = jdInput.value.trim();

            // 1. Reset & Show Uploading State
            filenameDisplay.textContent = file.name;
            stateInitial.classList.add('hidden');
            stateUploading.classList.remove('hidden');
            step2.classList.add('hidden'); 

            // 2. Prepare Form Data (File + Job Description)
            const formData = new FormData();
            formData.append('file', file);
            formData.append('job_description', jdText); 

            try {
                // Visual delay for "Analysis" feel
                setTimeout(() => { step2.classList.remove('hidden'); }, 800);

                const response = await fetch('/analyze', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (!response.ok) throw new Error(data.error || "Upload failed");

                // 3. Populate UI with Backend Data
                // Note: The backend returns keys: score, summary, strengths, weaknesses
                
                // Score
                scoreDisplay.textContent = data.score;
                
                // Summary
                summaryText.textContent = data.summary || "Analysis complete.";

                // Strengths List
                if (data.strengths && data.strengths.length > 0) {
                    strengthsList.innerHTML = data.strengths.map(item => `
                        <li class="flex items-start gap-3 text-sm text-gray-700">
                            <i class="ph ph-check-circle text-green-500 mt-0.5 shrink-0 text-lg"></i>
                            <span>${item}</span>
                        </li>
                    `).join('');
                } else {
                    strengthsList.innerHTML = '<li class="text-sm text-gray-400">No specific strengths detected.</li>';
                }

                // Weaknesses List
                if (data.weaknesses && data.weaknesses.length > 0) {
                    weaknessesList.innerHTML = data.weaknesses.map(item => `
                        <li class="flex items-start gap-3 text-sm text-gray-700">
                            <i class="ph ph-x-circle text-orange-500 mt-0.5 shrink-0 text-lg"></i>
                            <span>${item}</span>
                        </li>
                    `).join('');
                } else {
                    weaknessesList.innerHTML = '<li class="text-sm text-gray-400">No major weaknesses detected.</li>';
                }

                // Show Success
                stateUploading.classList.add('hidden');
                stateSuccess.classList.remove('hidden');

            } catch (error) {
                alert("Error: " + error.message);
                resetUploader();
            }
        }

        function resetUploader() {
            stateSuccess.classList.add('hidden');
            stateInitial.classList.remove('hidden');
            stateUploading.classList.add('hidden');
            fileInput.value = '';
            
            // We do NOT clear the JD input, so the user can try another resume with the same JD
            // jdInput.value = ''; 
            
            scoreDisplay.textContent = '--';
            strengthsList.innerHTML = '';
            weaknessesList.innerHTML = '';
        }
    </script>
</body>
</html>